<p-slide class="center">
  <img src="img/angular-logo.png" alt="angular logo" class="alter-image-size" style="--image-start-size: 6.5em" />
  <h3 class="main-gradient" style="margin-block-start: 0.3em">Angular Web Workers</h3>
</p-slide>
<p-slide>
  <h4 style="margin-block-end: 0.5em">⚙️ <span class="main-sub-gradient">Angular CLI</span></h4>
  <pre class="small-line" data-label-file="terminal">
    <code class="language-markdown">
      ng g web-worker services/worker-test
      
      </code><p-fragment><code class="language-javascript">CREATE src/app/services/worker-test.worker.ts (157 bytes)</code></p-fragment>
      <p-fragment><code class="language-javascript">CREATE tsconfig.worker.json (334 bytes)</code></p-fragment>
      <p-fragment><code class="language-javascript">UPDATE angular.json (2946 bytes)</code></p-fragment>
      <p-fragment><code class="language-javascript">UPDATE src/app/services/worker-test.service.ts (537 bytes)</code></p-fragment>
    </pre>
  <p-notes>
    <p><b>angular.json:</b> new property WebWorkerTsConfig inside build --> options that refer to tsconfig.worker.json</p>
  </p-notes>
</p-slide>
<p-slide>
  <pre class="small-line" data-label-file="worker-test.worker.ts">
    <code class="language-javascript">
      /// &lt;reference lib="webworker" />

      addEventListener('message', ({ data }) => {
        const response = `worker response to ${data}`;
        postMessage(response);
      });

    </code>
    </pre>
  <p-notes>
    The /// &lt;reference lib="webworker" /> directive is a TypeScript declaration that tells the compiler to include the type definitions specific to Web Workers. <br /><br />What
    is it for? By default, TypeScript uses DOM types, which include APIs like document, window, etc. However, Web Workers do not have access to these APIs (for example, window does
    not exist in a worker). In Angular, when you create a Web Worker, this directive ensures that TypeScript uses the correct set of types, providing only the APIs available in a
    Web Worker, such as postMessage, onmessage, and other global objects typical of a worker.
  </p-notes>
</p-slide>
<p-slide>
  <pre class="small-line" data-label-file="worker-test.worker.ts">
    <code class="language-javascript mid-dimension">
      // ...
      export class WorkerTestService {
        constructor() { }
      }
      </code>
    <p-fragment><code class="language-javascript mid-dimension">if (typeof Worker !== 'undefined') {
        // Create a new
        const worker = new Worker(new URL('./worker-test.worker', import.meta.url));</code></p-fragment>
      <p-fragment><code class="language-javascript mid-dimension">worker.onmessage = ({ data }) => {
          console.log(`page got message: ${data}`);
        };
        worker.postMessage('hello');</code></p-fragment>
    <p-fragment><code class="language-javascript mid-dimension">} else {
        // Web Workers are not supported in this environment.
        // You should add a fallback so that your program still executes correctly.
      }</code></p-fragment>
    </pre>
</p-slide>
<p-slide>
  <h3 style="margin-block-end: 0.9em">⚙️ <span class="main-sub-gradient">Angular CLI</span></h3>
  <ul class="space" style="--web-day-ul-space: 0.2em; font-weight: 100">
    <li>🆕 <span class="main-gradient">Create new file</span> for us</li>
    <p-fragment
      ><li>🆕 Create new file <span class="main-gradient">tsconfig.worker.json</span> <i>(only fist time)</i></li></p-fragment
    >
    <p-fragment
      ><li>🔄 Update <span class="main-gradient">angular.json</span> <i>(only fist time)</i></li></p-fragment
    >
    <p-fragment
      ><li>🔄 <span class="main-gradient">Update</span> class file for us if web worker has the same name</li></p-fragment
    >
  </ul>
</p-slide>
<p-slide autoplay timing="600" class="center">
  <h1 class="main-gradient">Let's craft some amazing code!</h1>
  <p-fragment><img src="img/omg.gif" alt="omg" class="alter-image-size" style="--image-start-size: 6em" /></p-fragment>
</p-slide>
<p-slide>
  <h4 style="margin-block-end: 0.5em" class="center">Let&#39;s Code 👨‍💻</h4>
  <pre class="small-line" data-label-file="worker-test.worker.ts">
    <code class="language-javascript">
      addEventListener('message', ({ data }) => {
        heavyTask();
        postMessage(`done "${data}" task`);
      });
    </code>
  </pre>
  <p-fragment
    ><span style="--circle-sketch-height: 1.3em; position: absolute; inset-block-end: 6.9em; width: 6em; inset-inline-start: 3em; z-index: 1" class="circle-sketch-highlight"></span
  ></p-fragment>
</p-slide>
<p-slide follow-fragments autoplay timing="100">
  <h4 style="margin-block-end: 0.5em" class="center">Let&#39;s Code 👨‍💻</h4>
  <p-fragment></p-fragment>
  <pre class="small-line" data-label-file="worker-test.worker.ts">
    <code class="language-javascript">
      //...
      export class WorkerTestService {
        #worker!: Worker;
        
        constructor() {
          this.createWorker();
        }
      
        createWorker() {
          this.#worker = new Worker(
            new URL('./worker-test.worker.ts', import.meta.url)
          );
        }
      </code>
      <p-fragment no-autoplay><code class="language-javascript">doHeavyWork(data: string): Observable&lt;string> {
          return new Observable((observer) => {
            this.#worker.onmessage = ({ data }: MessageEvent&lt;string>) => {
              observer.next(data);
              observer.complete();
            };
            this.#worker.onerror = (error) => observer.error(error);
            this.#worker.postMessage(data);
          });
        }
      }</code></p-fragment>
    </pre>
  <p-fragment no-autoplay
    ><span style="--circle-sketch-height: 2.3em; position: absolute; inset-block-end: 8em; width: 8em; inset-inline-start: 5em; z-index: 1" class="circle-sketch-highlight"></span
  ></p-fragment>
</p-slide>
<p-slide>
  <h4 style="margin-block-end: 0.5em" class="center">Let&#39;s Code 👨‍💻</h4>
  <pre class="small-line" data-label-file="home.component.ts">
    <code class="language-javascript">
      // ...
      export class HomeComponent {
        readonly #workerService = inject(WorkerTestService);
        
        startHeavyWorkInWorker() {
          this.#workerService
            .doHeavyWork('daje')
            .subscribe((data) => console.log(data)); // done "daje" task
        }
      }</code>
  </pre>
</p-slide>
