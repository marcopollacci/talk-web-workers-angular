<p-slide class="center">
  <h1>âš™ï¸ <span class="main-gradient">Web Workers</span></h1>
</p-slide>
<p-slide>
  <ul style="line-height: 1.8em">
    <li>ğŸ£ <span class="main-sub-gradient">Born in 2009</span></li>
    <p-fragment
      ><li>ğŸ§® <span class="main-sub-gradient">Multi-threaded code execution</span></li></p-fragment
    >
    <p-fragment
      ><li>ğŸ”’ <span class="main-sub-gradient">Fully isolated</span></li></p-fragment
    >
    <p-fragment
      ><li>ğŸš¨ <span class="main-sub-gradient">Not only Angular!</span></li></p-fragment
    >
  </ul>
  <p-notes>
    <p>Fully isolated: a web worker cannot access the DOM and main thread, but can only send and receive messages</p>
    <p>Not only Angular: a web worker can be used in any JavaScript environment</p>
  </p-notes>
</p-slide>
<p-slide class="cover">
  <h1>Some example in web browser</h1>
</p-slide>
<p-slide>
  <h4 style="margin-block-end: 0.5em" class="center">Let&#39;s Code ğŸ‘¨â€ğŸ’»</h4>
  <pre class="small-line" data-label-file="worker.js">
 <code class="language-javascript"> 
  self.onmessage = (event) => {
    console.log("Worker received:", event.data);
    // Do heavy stuff
    self.postMessage(`Hello from worker!`);
  };
</code>
</pre>
  <p-fragment
    ><span style="--circle-sketch-height: 1.8em; position: absolute; inset-block-end: 8em; width: 4em; inset-inline-start: 6.5em; z-index: 1" class="circle-sketch-highlight"></span
  ></p-fragment>
  <p-fragment
    ><span
      style="--circle-sketch-height: 1.8em; position: absolute; inset-block-end: 5.7em; width: 5em; inset-inline-start: 3.5em; z-index: 1"
      class="circle-sketch-highlight"></span
  ></p-fragment>
</p-slide>
<p-slide>
  <h4 style="margin-block-end: 0.5em" class="center">Let&#39;s Code ğŸ‘¨â€ğŸ’»</h4>
  <pre class="small-line language-javascript" data-label-file="main.js">
    <p-fragment><code class="language-javascript">
  const worker = new Worker("worker.js");</code></p-fragment>

  <p-fragment><code class="language-javascript">worker.onmessage = (event) => {
    console.log("Main thread received:", event.data);
    // Do some other stuff
   };</code></p-fragment>
  <p-fragment><code class="language-javascript">
   // Starting point
   worker.postMessage("Hello Web Day!");</code></p-fragment>
  </pre>
</p-slide>
<p-slide>
  <h4 style="margin-block-end: 0.5em" class="center">â—(áµ”á—œáµ”)â—œ</h4>
  <img src="img/console_log_worker.png" alt="console log worker" class="alter-image-size" style="--image-start-size: 3.5em" />
</p-slide>
<p-slide>
  <img src="img/sofar-sogood.jpg" alt="sofar sogood meme" class="alter-image-size" style="--image-start-size: 8em" />
</p-slide>
<p-slide>
  <h3><span class="main-gradient">Let's go further</span> á¯“ğŸƒğŸ»â€â™€ï¸â€â¡ï¸</h3>
</p-slide>
<p-slide>
  <code style="width: fit-content" class="language-javascript">self.onmessage = (event) => {};</code>
</p-slide>
<p-slide>
  <code style="width: fit-content" class="language-javascript mid-dimension">self.onmessage = (event) => {};</code>
  <ul class="grid-two-columns">
    <p-fragment><li>ğŸ“ data</li></p-fragment>
    <p-fragment><li>ğŸ“ origin</li></p-fragment>
    <p-fragment><li>ğŸ“ source</li></p-fragment>
    <p-fragment><li>ğŸ“ lastEventID</li></p-fragment>
    <p-fragment><li>ğŸ“ ports</li></p-fragment>
  </ul>
  <p-notes>
    <p><b>-->all of these properties are read-only<--</b></p>
    <p>data: The data sent from the main thread to the web worker</p>
    <p>origin: The origin of the main thread</p>
    <p>source: The source of the web worker</p>
    <p>lastEventId: The last event uniqueID</p>
    <p>ports: An array of ports associated with the web worker</p>
  </p-notes>
</p-slide>
<p-slide>
  <code style="width: fit-content" class="language-javascript">postMessage(message, transfer)</code>
</p-slide>
<p-slide class="center">
  <code style="width: fit-content" class="language-javascript mid-dimension">postMessage(message, transfer)</code>
  <div class="flex two-columns-divided-vertically" style="margin-block-start: 1em">
    <div>
      <p>ğŸ’¬ <span class="main-sub-gradient">message</span></p>
      <p-fragment><p>Can be any JavaScript object</p></p-fragment>
      <p-fragment><p>required</p></p-fragment>
    </div>
    <div>
      <p>ğŸšš <span class="main-gradient">transfer</span></p>
      <p-fragment><p>List of transferable objects</p></p-fragment>
      <p-fragment><p>optional</p></p-fragment>
    </div>
  </div>
  <p-notes>
    <p>
      By default, when you use postMessage(message), the message is copied into the Worker's context (or the main thread) by structured cloning mechanism. But if you want to
      improve performance, you can transfer specific types of data instead of copying them
    </p>
    <ul>
      <li>ArrayBuffer</li>
      <li>MessagePort</li>
      <li>ImageBitmap</li>
      <li>OffscreenCanvas</li>
      <li>ReadableStream, WritableStream, TransformStream</li>
    </ul>
  </p-notes>
</p-slide>
<p-slide>
  <code style="width: fit-content" class="language-javascript">worker.onerror = (event) => {};</code>
</p-slide>
<p-slide>
  <code style="width: fit-content" class="language-javascript mid-dimension">worker.onerror = (event) => {};</code>
  <ul class="space" style="margin-block-start: 0.7em">
    <p-fragment><li>â›” ErrorEvent</li></p-fragment>
    <p-fragment
      ><li>
        ğŸ’¬ Optional string on <span class="main-sub-gradient">message</span> properties
        <pre style="border-radius: 0.5em; box-shadow: inset 0 0 0.09em rgba(0, 0, 0, 0.25)"><code class="language-javascript mid-dimension">worker.onerror = (event) => { 
  console.log(event.message);
};</code></pre>
      </li></p-fragment
    >
  </ul>
</p-slide>
